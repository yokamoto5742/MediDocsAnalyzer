# 医療文書集計アプリケーション

## 概要
このアプリケーションは医療機関で作成された医療文書の集計・分析を行うためのツールです。
ソースファイルから医療文書担当一覧データベースを更新し、指定された期間内の文書作成担当者ごと、診療科ごとの集計結果を表示します。

## 特徴
- 医療文書データの読込と集計機能
- 期間指定による分析
- 担当者別、診療科別の文書作成件数の集計
- 集計結果のExcel出力

## 動作環境
- Windows OS
- Python 3.11以上
- 必要なライブラリ: 
  - tkinter (GUIフレームワーク)
  - tkcalendar (日付選択UI)
  - openpyxl (Excel操作)
  - polars (データ処理)

## インストール方法
1. リポジトリをクローンまたはダウンロードします
2. 必要なライブラリをインストールします：
   ```
   pip install -r requirements.txt
   ```

## 使用方法
1. アプリケーションを起動します：
   ```
   python main.py
   ```
2. GUI画面で分析期間（開始日と終了日）を設定します
3. 「データ読込」ボタンを押して、ソースファイルからデータを読み込みます
4. 「集計開始」ボタンを押して、分析を実行します
5. 集計結果はExcelファイルとして出力され、自動的に開かれます

## 設定ファイル
アプリケーションの設定は `config.ini` ファイルで管理されています。主な設定項目は以下の通りです：

### [Appearance]
- `window_width` - ウィンドウの幅
- `window_height` - ウィンドウの高さ

### [PATHS]
- `source_file_path` - 医療文書担当一覧ソースファイルのパス
- `database_path` - 医療文書担当一覧データベースのパス
- `backup_dir` - バックアップディレクトリのパス
- `template_path` - 出力用テンプレートファイルのパス
- `output_dir` - 出力ディレクトリのパス
- `config_path` - 設定ファイルのパス

### [Analysis]
- `start_date` - デフォルトの分析開始日
- `end_date` - デフォルトの分析終了日
- `ordered_names` - 集計表示する担当者名のリスト
- `clinical_departments` - 集計表示する診療科のリスト

## ファイル構成
- `main.py` - アプリケーションのエントリーポイント
- `app_window.py` - GUIの実装
- `service_medical_docs_analyzer.py` - 医療文書の集計ロジック
- `service_medical_docs_processor.py` - 医療文書担当一覧データベースの処理ロジック
- `service_data_processor.py` - データ処理ユーティリティ
- `service_excel_handler.py` - Excel操作ユーティリティ
- `config.ini` - 設定ファイル

## データ処理の流れ
1. 医療文書担当一覧ソースファイルからデータを読み込み医療文書担当一覧データベースに登録
2. 以下の条件でデータをフィルタリング：
   - 医師依頼日が空でない
   - 担当者名が空でない
   - 預り日が指定期間内
3. 重複行の削除 (預り日、患者ID、文書名、診療科、医師名が同じ行)
4. 担当者別、診療科別に集計
5. 集計結果をExcelファイルに出力

## バックアップ機能
データベースファイルは処理前に自動的にバックアップされます。バックアップは指定されたバックアップディレクトリに保存されます。

## 注意事項
- 初回実行時は設定ファイルで正しいファイルパスを設定してください
- ソースファイルは指定された列構造を持つExcelファイルである必要があります
- 日付形式は「YYYY/MM/DD」または「YYYY-MM-DD」形式が処理可能です

## 開発者向け情報
コードを拡張または修正する際は以下の点に注意してください：
- `app_window.py` - GUI関連のコードを修正
- `service_medical_docs_analyzer.py` - 集計ロジックを修正
- `service_data_processor.py` - データ処理機能を修正
- `service_excel_handler.py` - Excel入出力機能を修正

## トラブルシューティング
- アプリケーションが起動しない場合：
  - Pythonと必要なライブラリが正しくインストールされているか確認
  - 設定ファイルのパスが正しいか確認
  - 
- データが読み込めない場合：
  - ソースファイルのパスが正しいか確認
  - ソースファイルの形式が正しいか確認
  - 
- 集計結果が表示されない場合：
  - 指定期間内にデータが存在するか確認
  - 出力先ディレクトリが存在するか確認

## ライセンス
このアプリケーションはMITライセンスの下で公開されています。詳細については[LICENSE](LICENSE)ファイルを参照してください。
```